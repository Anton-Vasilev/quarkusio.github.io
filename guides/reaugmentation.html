<div class="sect1">
<h2 id="what-is-augmentation"><a class="anchor" href="#what-is-augmentation"></a>What is augmentation?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus application configuration may include two types of configuration options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Build time options, handled during the application build time;</p>
</li>
<li>
<p>Runtime options, that may be adjusted after the application has been built but before it has been launched.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The augmentation is a phase of an application build process during which the byte code of the application is optimized according to the application build time configuration.
Initialization steps that used to happen when an EAR file was deployed on a Jakarta EE server such as parsing static configuration, creating proxy instances, etc. now happen at augmentation time.
CDI beans added after augmentation won&#8217;t work (because of the missing proxy classes) as well as build time properties (e.g. <code>quarkus.datasource.db-kind</code>) changed after augmentation will be ignored.
Build time properties are marked with a lock icon (<span class="icon"><i class="fa fa-lock"></i></span>) in the <a href="all-config">list of all configuration options</a>.
It doesn&#8217;t matter if you use profiles or any other way to override the properties.
The build time properties that were active during augmentation are baked into the build.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Re-augmentation is the process of recreating the augmentation output for a different build time configuration</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="when-is-re-augmentation-useful"><a class="anchor" href="#when-is-re-augmentation-useful"></a>When is re-augmentation useful?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Re-augmentation is useful in case the users of your application want to be able to change some of its build time properties.
For instance changing the database driver or switching features on or off (e.g. <a href="opentracing">OpenTracing</a> or <a href="https://quarkiverse.github.io/quarkiverse-docs/quarkus-config-extensions/dev/consul.html">Config Consul</a>).
If there are only two or three build time properties that depend on the user environment, you may consider providing alternative builds of the application. However, in case there are more such properties you may prefer shipping a mutable jar instead and let your users re-augment the application for their environment.
Please notice that you won&#8217;t be able to use native images with the package type <code>mutable-jar</code>.
Think of the consequences and what other options you have!</p>
</div>
<div class="paragraph">
<p>It is not a good idea to do re-augmentation at runtime unless you miss the good old times when starting up a server took several minutes and you could enjoy a cup of coffee until it was ready.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-to-re-augment-a-quarkus-application"><a class="anchor" href="#how-to-re-augment-a-quarkus-application"></a>How to re-augment a Quarkus application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to run the augmentation steps you need the deployment JARs of the used Quarkus extensions.
These JARs are only present in the <code>mutable-jar</code> distribution. This means that you need to build your application with <code>quarkus.package.type=mutable-jar</code>.
The <code>mutable-jar</code> distribution is the same as the <code>fast-jar</code> distribution, except for the additional folder <code>quarkus-app/lib/deployment</code>
which contains the deployment JARs and their dependencies (and some class-loader configuration).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default, you&#8217;ll get a warning if a build time property has been changed at runtime.
You may set the <code>quarkus.configuration.build-time-mismatch-at-runtime=fail</code> property to make sure your application does not start up if there is a mismatch.
However, as of this writing changing <code>quarkus.datasource.db-kind</code> at runtime did neither fail nor produce a warning but was silently ignored.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="1-build-your-application-as-mutable-jar"><a class="anchor" href="#1-build-your-application-as-mutable-jar"></a>1. Build your application as <code>mutable-jar</code></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean install -Dquarkus.package.type=mutable-jar</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="2-re-augment-your-application-with-a-different-build-time-configuration"><a class="anchor" href="#2-re-augment-your-application-with-a-different-build-time-configuration"></a>2. Re-augment your application with a different build time configuration</h3>
<div class="paragraph">
<p>In order to re-augment your Quarkus application with different build time properties, start the application with the desired configuration plus the <code>quarkus.launch.rebuild</code> system property set to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The following example changes the <code>quarkus.datasource.db-kind</code> to <code>mysql</code>. For this to work the <code>mysql-extension</code> must have been included in the build. Augmentation can only use extensions that were present during compile time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">java -jar -Dquarkus.launch.rebuild=true -Dquarkus.datasource.db-kind=mysql target/quarkus-app/quarkus-run.jar</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It does not matter if you use system properties, environment variables, profiles, or an external config file. The current
configuration will be used for augmentation (the content of <code>quarkus-app/quarkus</code> will be replaced with the new augmentation output).
The command line above will not launch the application. Quarkus will exit immediately after the application has been re-augmented.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="3-optional-delete-the-deployments-folder"><a class="anchor" href="#3-optional-delete-the-deployments-folder"></a>3. Optional: Delete the deployments folder</h3>
<div class="paragraph">
<p>You may delete the directory <code>quarkus-app/lib/deployment</code> to save some space in your ZIP distribution or Docker image (remember to use a multistage Docker build to avoid unnecessary layers). After deleting the <code>deployment</code> directory, it is obviously not possible anymore to re-augment the application.</p>
</div>
</div>
</div>
</div>