<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This page explains how to deploy your gRPC service in Quarkus in Kubernetes.
We&#8217;ll continue with the example from <a href="grpc-getting-started">the Getting Started gRPC guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-your-project-to-use-the-quarkus-kubernetes-extension"><a class="anchor" href="#configuring-your-project-to-use-the-quarkus-kubernetes-extension"></a>Configuring your project to use the Quarkus Kubernetes extension</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add the Quarkus Kubernetes extension to your build file:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-kubernetes&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.quarkus:quarkus-kubernetes")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we want to expose our application using the Kubernetes Ingress resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.kubernetes.ingress.expose=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Quarkus Kubernetes will bind the HTTP server using the port name <code>http</code> and the gRPC server using the port name <code>grpc</code>. By default, the Quarkus application will only expose the port name <code>http</code>, so only the HTTP server will be publicly accessible. To expose the gRPC server instead, set the <code>quarkus.kubernetes.ingress.target-port=grpc</code> property in your application.properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.kubernetes.ingress.target-port=grpc</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you configure Quarkus to use the same port for both HTTP and gRPC servers with the property <code>quarkus.grpc.server.use-separate-server=false</code>, then you don&#8217;t need to change the default <code>target-port</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, we need to generate the Kubernetes manifests by running the command in a terminal:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in grpc-kubernetes.adoc - include::{includes}/devtools/build.adoc[]</p>
</div>
<div class="paragraph">
<p>Once generated, you can look at the <code>target/kubernetes</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-txt hljs" data-lang="txt">target/kubernetes
└── kubernetes.json
└── kubernetes.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find more information about how to deploy the application in Kubernetes in the <a href="deploying-to-kubernetes#deployment">the Kubernetes guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-grpc-health-probes"><a class="anchor" href="#using-grpc-health-probes"></a>Using gRPC Health probes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the Kubernetes resources do not contain readiness and liveness probes. To add them, import the Smallrye Health extension to your build file:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-smallrye-health&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.quarkus:quarkus-smallrye-health")</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
More information about the health extension can be found in <a href="microprofile-health">the Microprofile Health guide</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By the default, this extension will configure the probes to use the HTTP server (which is provided by some extensions like the Quarkus RESTEasy reactive extension). Internally, this probe will also use <a href="grpc-service-implementation#health">the generated gRPC Health services</a>.</p>
</div>
<div class="paragraph">
<p>If your application does not use any Quarkus extension that exposes an HTTP server, you can still configure the probes to directly use the gRPC Health service by adding the property <code>quarkus.kubernetes.readiness-probe.grpc-action-enabled=true</code> into your configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.kubernetes.readiness-probe.grpc-action-enabled=true</code></pre>
</div>
</div>
</div>
</div>