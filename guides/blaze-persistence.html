<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Blaze-Persistence offers a fluent query builder API on top of Jakarta Persistence with a deep Hibernate ORM integration that enables the
use of advanced SQL features like Common Table Expressions while staying in the realm of the Jakarta Persistence model.</p>
</div>
<div class="paragraph">
<p>On top of that, the Blaze-Persistence Entity-View module allows for DTO definitions that can be applied to business logic
queries which are then transformed to optimized queries that only fetch the data that is needed to construct the DTO instances.
The same DTO definitions can further be used for applying database updates, leading to a great reduction in boilerplate
code and removing the need for object mapping tools.</p>
</div>
<div class="paragraph">
<p>Unresolved directive in blaze-persistence.adoc - include::{includes}/platform-include.adoc[]</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-and-configuring-blaze-persistence"><a class="anchor" href="#setting-up-and-configuring-blaze-persistence"></a>Setting up and configuring Blaze-Persistence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The extension comes with default producers for <code>CriteriaBuilderFactory</code> and <code>EntityViewManager</code> that work out of the
box given a working Hibernate ORM configuration. For customization, overriding of the default producers is possible via the
standard mechanism as documented in the <a href="cdi-reference#default_beans">Quarkus CDI reference</a>.
This is needed if you need to set custom <a href="https://persistence.blazebit.com/documentation/entity-view/manual/en_US/index.html#anchor-configuration-properties">Blaze-Persistence properties</a>.</p>
</div>
<div class="paragraph">
<p>In Quarkus, you just need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Inject</code> <code>CriteriaBuilderFactory</code> or <code>EntityViewManager</code> and use it</p>
</li>
<li>
<p>annotate your entity views with <code>@EntityView</code> and any other mapping annotation as usual</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add the following dependencies to your project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the Blaze-Persistence extension: <code>com.blazebit:blaze-persistence-integration-quarkus</code></p>
</li>
<li>
<p>further Blaze-Persistence integrations as needed:</p>
<div class="ulist">
<ul>
<li>
<p><code>blaze-persistence-integration-jackson</code> for <a href="https://persistence.blazebit.com/documentation/entity-view/manual/en_US/index.html#Jackson%20integration">Jackson</a></p>
</li>
<li>
<p><code>blaze-persistence-integration-jaxrs</code> for <a href="https://persistence.blazebit.com/documentation/entity-view/manual/en_US/index.html#jaxrs-integration">Jakarta REST</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">Example dependencies using Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Blaze-Persistence specific dependencies --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.blazebit&lt;/groupId&gt;
    &lt;artifactId&gt;blaze-persistence-integration-quarkus&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.blazebit&lt;/groupId&gt;
    &lt;artifactId&gt;blaze-persistence-integration-hibernate-5.6&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">Using Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("com.blazebit:blaze-persistence-integration-quarkus")
runtimeOnly("com.blazebit:blaze-persistence-integration-hibernate-5.6")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The use in native images requires a dependency on the entity view annotation processor that may be extracted into a separate <code>native</code> profile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profiles&gt;
    &lt;profile&gt;
        &lt;id&gt;native&lt;/id&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.blazebit&lt;/groupId&gt;
                &lt;artifactId&gt;blaze-persistence-entity-view-processor&lt;/artifactId&gt;
                &lt;scope&gt;provided&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/profile&gt;
&lt;/profiles&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>CriteriaBuilderFactory</code> and an <code>EntityViewManager</code> will be created based on the configured <code>EntityManagerFactory</code> as provided by the <a href="hibernate-orm">Hibernate-ORM extension</a>.</p>
</div>
<div class="paragraph">
<p>You can then access these beans via injection:</p>
</div>
<div class="listingblock">
<div class="title">Example application bean using Hibernate</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class SantaClausService {
    @Inject
    EntityManager em; <i class="conum" data-value="1"></i><b>(1)</b>
    @Inject
    CriteriaBuilderFactory cbf; <i class="conum" data-value="2"></i><b>(2)</b>
    @Inject
    EntityViewManager evm; <i class="conum" data-value="3"></i><b>(3)</b>

    @Transactional <i class="conum" data-value="4"></i><b>(4)</b>
    public List&lt;GiftView&gt; findAllGifts() {
        CriteriaBuilder&lt;Gift&gt; cb = cbf.create(em, Gift.class);
        return evm.applySetting(EntityViewSetting.create(GiftView.class), cb).getResultList();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the <code>EntityManager</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>CriteriaBuilderFactory</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Inject the <code>EntityViewManager</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Mark your CDI bean method as <code>@Transactional</code> so that a transaction is started or joined.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Entity</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
public class Gift {
    private Long id;
    private String name;
    private String description;

    @Id @GeneratedValue(strategy = GenerationType.SEQUENCE, generator="giftSeq")
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }


    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Entity-View</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EntityView(Gift.class)
public interface GiftView {

    @IdMapping
    Long getId();

    String getName();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example updatable Entity-View</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@UpdatableEntityView
@CreatableEntityView
@EntityView(Gift.class)
public interface GiftUpdateView extends GiftView {

    void setName(String name);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Jakarta REST Resource</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/gifts")
public class GiftResource {
    @Inject
    EntityManager entityManager;
    @Inject
    EntityViewManager entityViewManager;
    @Inject
    SantaClausService santaClausService;

    @POST
    @Transactional
    public Response createGift(GiftUpdateView view) {
        entityViewManager.save(entityManager, view);
        return Response.created(URI.create("/gifts/" + view.getId())).build();
    }

    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public List&lt;GiftView&gt; getGifts() {
        return santaClausService.findAllGifts();
    }

    @PUT
    @Path("{id}")
    @Transactional
    public GiftView updateGift(@EntityViewId("id") GiftUpdateView view) {
        entityViewManager.save(entityManager, view);
        return entityViewManager.find(entityManager, GiftView.class, view.getId());
    }

    @GET
    @Path("{id"})
    @Produces(MediaType.APPLICATION_JSON)
    public GiftView getGift(Long id) {
        return return entityViewManager.find(entityManager, GiftView.class, view.getId());
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="blaze-persistence-configuration-properties"><a class="anchor" href="#blaze-persistence-configuration-properties"></a>Blaze-Persistence configuration properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are various optional properties useful to refine your <code>EntityViewManager</code> and <code>CriteriaBuilderFactory</code> or guide guesses of Quarkus.</p>
</div>
<div class="paragraph">
<p>There are no required properties, as long as the Hibernate ORM extension is configured properly.</p>
</div>
<div class="paragraph">
<p>When no property is set, the Blaze-Persistence defaults apply.</p>
</div>
<div class="paragraph">
<p>The configuration properties listed here allow you to override such defaults, and customize and tune various aspects.</p>
</div>
<div class="paragraph">
<p>Apart from these configuration options, further configuration and customization can be applied by observing a <code>CriteriaBuilderConfiguration</code> or <code>EntityViewConfiguration</code> events and applying customizations on these objects. The various customization use cases can be found in the <a href="https://persistence.blazebit.com/documentation/entity-view/manual/en_US/index.html#quarkus-customization">Quarkus section of the entity-view documentation</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example CriteriaBuilderConfiguration and EntityViewConfiguration observing</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class BlazePersistenceConfigurer {

    public void configure(@Observes CriteriaBuilderConfiguration config) {
        config.setProperty("...", "...");
    }

    public void configure(@Observes EntityViewConfiguration config) {
        // Register custom BasicUserType or register type test values
        config.registerBasicUserType(MyClass.class, MyClassBasicUserType.class);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="limitations"><a class="anchor" href="#limitations"></a>Limitations</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">Apache Derby</dt>
<dd>
<p>Blaze-Persistence currently does not come with support for Apache Derby.
This limitation could be lifted in the future, if there&#8217;s a compelling need for it and if someone contributes it.</p>
</dd>
</dl>
</div>
</div>
</div>