<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>While users are encouraged to use <a href="scheduler#standard-scheduling">regular Quarkus scheduler</a>, Quarkus provides a compatibility layer for Spring Scheduled in the form of the <code>spring-scheduled</code> extension.</p>
</div>
<div class="paragraph">
<p>This guide explains how a Quarkus application can leverage the well known Spring Scheduled annotation to configure and schedule tasks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unresolved directive in spring-scheduled.adoc - include::{includes}/prerequisites.adoc[]
* Some familiarity with the Spring Web extension</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution"><a class="anchor" href="#solution"></a>Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step.
However, you can go right to the completed example.</p>
</div>
<div class="paragraph">
<p>Clone the Git repository: <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code>, or download an <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/main.zip">archive</a>.</p>
</div>
<div class="paragraph">
<p>The solution is located in the <code>spring-scheduled-quickstart</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/spring-scheduled-quickstart">directory</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-maven-project"><a class="anchor" href="#creating-the-maven-project"></a>Creating the Maven project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, we need a new project. Create a new project with the following command:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in spring-scheduled.adoc - include::{includes}/devtools/create-app.adoc[]</p>
</div>
<div class="paragraph">
<p>This command generates a Maven project with the <code>spring-scheduled</code> extension.</p>
</div>
<div class="paragraph">
<p>If you already have your Quarkus project configured, you can add the <code>spring-scheduled</code> extension
to your project by running the following command in your project base directory:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in spring-scheduled.adoc - include::{includes}/devtools/extension-add.adoc[]</p>
</div>
<div class="paragraph">
<p>This will add the following to your build file:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-spring-scheduled&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.quarkus:quarkus-spring-scheduled")</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-scheduled-job"><a class="anchor" href="#creating-a-scheduled-job"></a>Creating a scheduled job</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the <code>org.acme.spring.scheduler</code> package, create the <code>CounterBean</code> class, with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.spring.scheduler;

import org.springframework.scheduling.annotation.Scheduled;

import java.util.concurrent.atomic.AtomicInteger;
import jakarta.enterprise.context.ApplicationScoped;

@ApplicationScoped              <i class="conum" data-value="1"></i><b>(1)</b>
public class CounterBean {

    private AtomicInteger counter = new AtomicInteger();

    public int get() {   <i class="conum" data-value="2"></i><b>(2)</b>
        return counter.get();
    }

    @Scheduled(cron="*/5 * * * * ?")   <i class="conum" data-value="3"></i><b>(3)</b>
    void cronJob() {
        counter.incrementAndGet();      <i class="conum" data-value="4"></i><b>(4)</b>
        System.out.println("Cron expression hardcoded");
    }

    @Scheduled(cron = "{cron.expr}")   <i class="conum" data-value="5"></i><b>(5)</b>
    void cronJobWithExpressionInConfig() {
        counter.incrementAndGet();
        System.out.println("Cron expression configured in application.properties");
    }

    @Scheduled(fixedRate = 1000)    <i class="conum" data-value="6"></i><b>(6)</b>
    void jobAtFixedRate() {
        counter.incrementAndGet();
        System.out.println("Fixed Rate expression");
    }

    @Scheduled(fixedRateString = "${fixedRate.expr}")      <i class="conum" data-value="7"></i><b>(7)</b>
    void jobAtFixedRateInConfig() {
        counter.incrementAndGet();
        System.out.println("Fixed Rate expression configured in application.properties");
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare the bean in the <em>application</em> scope. Spring only detects @Scheduled annotations in beans.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>get()</code> method allows retrieving the current value.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the Spring <code>@Scheduled</code> annotation with a cron-like expression to instruct Quarkus to schedule this method run.  In this example we&#8217;re scheduling a task to be executed at 10:15am every day.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The code is pretty straightforward. Every day at 10:15am, the counter is incremented.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Define a job with a cron-like expression <code>cron.expr</code> which is configurable in <code>application.properties</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Define a method to be executed at a fixed interval of time. The period is expressed in milliseconds.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Define a job to be executed at a fixed interval of time <code>fixedRate.expr</code> which is configurable in <code>application.properties</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updating-the-application-configuration-file"><a class="anchor" href="#updating-the-application-configuration-file"></a>Updating the application configuration file</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Edit the <code>application.properties</code> file and add the <code>cron.expr</code> and the <code>fixedRate.expr</code> configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># The syntax used by Spring for cron expressions is the same as which is used by regular Quarkus scheduler.
cron.expr=*/5 * * * * ?
fixedRate.expr=1000</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-resource-and-the-test"><a class="anchor" href="#creating-the-resource-and-the-test"></a>Creating the resource and the test</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create the <code>CountResource</code> class with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.spring.scheduler;

import jakarta.inject.Inject;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;

@Path("/count")
public class CountResource {

    @Inject
    CounterBean counter;    <i class="conum" data-value="1"></i><b>(1)</b>


    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public String hello() {
        return "count: " + counter.get();   <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the <code>CounterBean</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Send back the current counter value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We also need to update the tests. Edit the <code>CountResourceTest</code> class to match:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.spring.scheduler;

import static io.restassured.RestAssured.given;
import static org.hamcrest.CoreMatchers.containsString;

import org.junit.jupiter.api.Test;

import io.quarkus.test.junit.QuarkusTest;

@QuarkusTest
public class CountResourceTest {

    @Test
    public void testHelloEndpoint() {
        given()
                .when().get("/count")
                .then()
                .statusCode(200)
                .body(containsString("count"));  <i class="conum" data-value="1"></i><b>(1)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ensure that the response contains <code>count</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="package-and-run-the-application"><a class="anchor" href="#package-and-run-the-application"></a>Package and run the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run the application with:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in spring-scheduled.adoc - include::{includes}/devtools/dev.adoc[]</p>
</div>
<div class="paragraph">
<p>In another terminal, run <code>curl localhost:8080/count</code> to check the counter value.
After a few seconds, re-run <code>curl localhost:8080/count</code> to verify the counter has been incremented.</p>
</div>
<div class="paragraph">
<p>Observe the console to verify that the following messages has been displayed:
- <code>Cron expression hardcoded</code>
- <code>Cron expression configured in application.properties</code>
- <code>Fixed Rate expression</code>
- <code>Fixed Rate expression configured in application.properties</code>
These messages indicate that the executions of methods annotated with <code>@Scheduled</code> have been triggered.</p>
</div>
<div class="paragraph">
<p>As usual, the application can be packaged using:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in spring-scheduled.adoc - include::{includes}/devtools/build.adoc[]</p>
</div>
<div class="paragraph">
<p>And executed using <code>java -jar target/quarkus-app/quarkus-run.jar</code>.</p>
</div>
<div class="paragraph">
<p>You can also generate the native executable with:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in spring-scheduled.adoc - include::{includes}/devtools/build-native.adoc[]</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-property-expressions"><a class="anchor" href="#using-property-expressions"></a>Using Property Expressions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus supports the use of property expressions in the <code>application.properties</code> file so to externalize the configuration of the tasks you should store the properties in the <code>application.properties</code> file and use the
<code>fixedRateString</code>, <code>initialDelayString</code> params respectively.</p>
</div>
<div class="paragraph">
<p>Note that this configuration is a build time configuration, the property expression will be resolved at build time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="unsupported-spring-scheduled-functionalities"><a class="anchor" href="#unsupported-spring-scheduled-functionalities"></a>Unsupported Spring Scheduled functionalities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus currently only supports a subset of the functionalities that Spring @Scheduled provides with more features being planned.
Currently, the <code>fixedDelay</code> and <code>fixedDelayString</code> parameters are not supported, in other words, <code>@Scheduled</code> methods are always executed independently.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="important-technical-note"><a class="anchor" href="#important-technical-note"></a>Important Technical Note</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Please note that the Spring support in Quarkus does not start a Spring Application Context nor are any Spring infrastructure classes run.
Spring classes and annotations are only used for reading metadata and / or are used as user code method return types or parameter types.
What that means for end users, is that adding arbitrary Spring libraries will not have any effect. Moreover, Spring infrastructure
classes (like <code>org.springframework.beans.factory.config.BeanPostProcessor</code> for example) will not be executed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="more-spring-guides"><a class="anchor" href="#more-spring-guides"></a>More Spring guides</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus has more Spring compatibility features. See the following guides for more details:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="spring-di">Quarkus - Extension for Spring DI</a></p>
</li>
<li>
<p><a href="spring-web">Quarkus - Extension for Spring Web</a></p>
</li>
<li>
<p><a href="spring-data-jpa">Quarkus - Extension for Spring Data JPA</a></p>
</li>
<li>
<p><a href="spring-data-rest">Quarkus - Extension for Spring Data REST</a></p>
</li>
<li>
<p><a href="spring-cloud-config-client">Quarkus - Reading properties from Spring Cloud Config Server</a></p>
</li>
<li>
<p><a href="spring-boot-properties">Quarkus - Extension for Spring Boot properties</a></p>
</li>
<li>
<p><a href="spring-cache">Quarkus - Extension for Spring Cache</a></p>
</li>
<li>
<p><a href="spring-security">Quarkus - Extension for Spring Security</a></p>
</li>
</ul>
</div>
</div>
</div>