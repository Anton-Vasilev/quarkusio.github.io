<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Unresolved directive in _attributes.adoc - include::_attributes-local.adoc[]</p>
</div>
<div class="paragraph">
<p>The Quarkus Keycloak Admin Client and its reactive twin support Keycloak Admin Client which can be used to configure a running Keycloak server.</p>
</div>
<div class="paragraph">
<p>This guide demonstrates how you can leverage the <a href="cdi-reference">Quarkus ArC</a> and inject the admin client to your Quarkus application, as well as how to create it directly in the application code.</p>
</div>
<div class="paragraph">
<p>To learn more about the Keycloak Admin Client, please refer to its <a href="https://www.keycloak.org/docs/latest/server_development/#example-using-java">reference guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unresolved directive in security-keycloak-admin-client.adoc - include::{includes}/prerequisites.adoc[]
* <a href="https://www.keycloak.org/docs/latest/server_installation/index.html">Keycloak</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-project"><a class="anchor" href="#creating-the-project"></a>Creating the Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, we need a new project.
Create a new project with the following command:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in security-keycloak-admin-client.adoc - include::{includes}/devtools/create-app.adoc[]</p>
</div>
<div class="paragraph">
<p>This command generates a project which imports the <code>keycloak-admin-client-reactive</code> and <code>resteasy-reactive-jackson</code> extensions.</p>
</div>
<div class="paragraph">
<p>If you already have your Quarkus project configured, you can add the <code>keycloak-admin-client-reactive</code> and <code>resteasy-reactive-jackson</code> extensions
to your project by running the following command in your project base directory:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in security-keycloak-admin-client.adoc - include::{includes}/devtools/extension-add.adoc[]</p>
</div>
<div class="paragraph">
<p>This will add the following to your build file:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-keycloak-admin-client-reactive&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-resteasy-reactive-jackson&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.quarkus:quarkus-keycloak-admin-client-reactive")
implementation("io.quarkus:quarkus-resteasy-reactive-jackson")</code></pre>
</div>
</div>
<div class="paragraph">
<p>We also are going to need a simple resource with a <code>Keycloak</code> injected as request scoped CDI bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.keycloak.admin.client;

import org.keycloak.admin.client.Keycloak;
import org.keycloak.representations.idm.RoleRepresentation;

import jakarta.inject.Inject;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import java.util.List;

@Path("/api/admin")
public class RolesResource {

        @Inject
        Keycloak keycloak; <i class="conum" data-value="1"></i><b>(1)</b>

        @GET
        @Path("/roles")
        public List&lt;RoleRepresentation&gt; getRoles() {
            return keycloak.realm("quarkus").roles().list();
        }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create  a default Keycloak Admin Client which can perform Keycloak <code>master</code> realm administration tasks as an <code>admin-cli</code> client, such as adding new realms, clients and users.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The only configuration which is required to create this Keycloak Admin Client is a Keycloak server URL.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># Quarkus based Keycloak distribution
quarkus.keycloak.admin-client.server-url=http://localhost:8081</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># WildFly based Keycloak distribution
quarkus.keycloak.admin-client.server-url=http://localhost:8081/auth</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is important that <code>quarkus.keycloak.admin-client.server-url</code> is configured if you would like to have <code>Keycloak</code> injected. The injection will fail if you attempt to inject <code>Keycloak</code> without configuring this property.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Injecting Keycloak Admin Client instead of creating it directly in the application code is a simpler and more flexible option but you can create the same admin client manually if necessary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.keycloak.admin.client;

import org.keycloak.admin.client.Keycloak;
import org.keycloak.admin.client.KeycloakBuilder;
import org.keycloak.representations.idm.RoleRepresentation;

import jakarta.annotations.PostConstruct;
import jakarta.annotations.PreConstruct;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import java.util.List;

@Path("/api/admin")
public class RolesResource {

        Keycloak keycloak;

        @PostConstruct
        public void initKeycloak() {
            keycloak = KeycloakBuilder.builder()
                .serverUrl("http://localhost:8081")
                .realm("master")
                .clientId("admin-cli")
                .grantType("password")
                .username("admin")
                .password("admin")
                .build();
        }

        @PreDestroy
        public void closeKeycloak() {
            keycloak.close();
        }

        @GET
        @Path("/roles")
        public List&lt;RoleRepresentation&gt; getRoles() {
            return keycloak.realm("quarkus").roles().list();
        }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details consult <a href="https://www.keycloak.org/docs/latest/server_development/#admin-rest-api">Keycloak Admin REST API documentation</a>.</p>
</div>
<div class="paragraph">
<p>You can configure Keycloak Admin Client to administer other realms and clients. It can use either a <code>password</code> or <code>client_credentials</code> grant to acquire an access token to call the Admin REST API which requires authorization.</p>
</div>
<div class="paragraph">
<p>If you exchange user&#8217;s credentials for the access token, here is an example configuration for the <code>password</code> grant type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.keycloak.admin-client.server-url=http://localhost:8081
quarkus.keycloak.admin-client.realm=quarkus
quarkus.keycloak.admin-client.client-id=quarkus-client
quarkus.keycloak.admin-client.username=alice
quarkus.keycloak.admin-client.password=alice
quarkus.keycloak.admin-client.grant-type=PASSWORD <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>password</code> grant type.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example using the <code>client-credentials</code> grant type needs only a minor adjustments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.keycloak.admin-client.enabled=true
quarkus.keycloak.admin-client.server-url=http://localhost:8081
quarkus.keycloak.admin-client.realm=quarkus
quarkus.keycloak.admin-client.client-id=quarkus-client
quarkus.keycloak.admin-client.client-secret=secret
quarkus.keycloak.admin-client.username= # remove default username
quarkus.keycloak.admin-client.password= # remove default password
quarkus.keycloak.admin-client.grant-type=CLIENT_CREDENTIALS <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>client_credentials</code> grant type.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that the <a href="security-openid-connect-client">OidcClient</a> can also be used to acquire tokens.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="keycloak-admin-client-configuration-reference"><a class="anchor" href="#keycloak-admin-client-configuration-reference"></a>Quarkus Keycloak Admin Client Configuration Reference</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="references"><a class="anchor" href="#references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.keycloak.org/documentation.html">Keycloak Documentation</a></p>
</li>
<li>
<p><a href="security-keycloak-authorization">Keycloak Authorization extension</a></p>
</li>
<li>
<p><a href="security-oidc-code-flow-authentication">OIDC code flow mechanism for protecting web applications</a></p>
</li>
<li>
<p><a href="security-oidc-bearer-token-authentication">OIDC Bearer token authentication</a></p>
</li>
<li>
<p><a href="security-openid-connect-client">OpenID Connect Client and Token Propagation Quickstart</a></p>
</li>
<li>
<p><a href="security-overview">Quarkus Security overview</a></p>
</li>
</ul>
</div>
</div>
</div>