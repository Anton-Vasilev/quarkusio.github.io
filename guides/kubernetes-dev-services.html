<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Dev Services for Kubernetes automatically starts a Kubernetes API server in dev mode and when running tests.
So you don&#8217;t have to start a Kubernetes cluster manually.
The application is configured automatically.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enabling-disabling-dev-services-for-kubernetes"><a class="anchor" href="#enabling-disabling-dev-services-for-kubernetes"></a>Enabling / Disabling Dev Services for Kubernetes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dev Services for Kubernetes is automatically enabled unless:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quarkus.kubernetes-client.devservices.enabled</code> is set to <code>false</code></p>
</li>
<li>
<p>the <code>api-server-url</code> is configured</p>
</li>
<li>
<p>a valid Kube config file is found and <code>quarkus.kubernetes-client.devservices.override-kubeconfig</code> is not set to <code>true</code></p>
</li>
<li>
<p>you include the <code>quarkus-test-kubernetes-client</code> dependency</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dev Services for Kubernetes relies on Docker to start the API server.
If your environment does not support Docker, you will need to start the Kubernetes cluster manually, or connect to an already running Kubernetes cluster.
You can configure the Kubernetes cluster access using either a Kube config file or the various properties available in the <a href="https://github.com/quarkusio/quarkus/blob/main/extensions/kubernetes-client/runtime-internal/src/main/java/io/quarkus/kubernetes/client/runtime/KubernetesClientBuildConfig.java">KubernetesClientBuildConfig</a> class.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shared-cluster"><a class="anchor" href="#shared-cluster"></a>Shared cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most of the time you need to share the cluster between applications.
Dev Services for Kubernetes implements a <em>service discovery</em> mechanism for your multiple Quarkus applications running in dev mode to share a single cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Dev Services for Kubernetes starts the container with the <code>quarkus-dev-service-kubernetes</code> label which is used to identify the container.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you need multiple (shared) clusters, you can configure the <code>quarkus.kubernetes-client.devservices.service-name</code> configuration property and indicate the cluster name.
It looks for a container with the name defined, or starts a new one if none can be found.
The default service name is <code>kubernetes</code>.</p>
</div>
<div class="paragraph">
<p>Sharing is enabled by default in dev mode, but disabled in test mode.
You can disable the sharing with <code>quarkus.kubernetes-client.devservices.shared=false</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-the-cluster"><a class="anchor" href="#configuring-the-cluster"></a>Configuring the cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dev Services for Kubernetes provides three different flavors of Kubernetes cluster. Each flavor supports different Kubernetes API versions.
You can configure the flavor and version using the <code>quarkus.kubernetes-client.devservices.flavor</code> and <code>quarkus.kubernetes-client.devservices.api-version</code> properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.kubernetes-client.devservices.flavor=api-only # k3s or kind
quarkus.kubernetes-client.devservices.api-version=1.22</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>api-only</code> only starts a Kubernetes API Server. If you need a fully-featured Kubernetes cluster that can spin up Pods, you can use <code>k3s</code> or <code>kind</code>. Note that they both requires to run in Docker privileged mode.</p>
</div>
<div class="paragraph">
<p>If <code>api-version</code> is not set, the latest version for the given flavor will be used. Otherwise, the version must match a <a href="https://github.com/dajudge/kindcontainer/blob/master/k8s-versions.json">version supported by the given flavor</a>.</p>
</div>
</div>
</div>