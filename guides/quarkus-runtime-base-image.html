<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Unresolved directive in _attributes.adoc - include::_attributes-local.adoc[]</p>
</div>
<div class="paragraph">
<p>To ease the containerization of native executables, Quarkus provides a base image providing the requirements to run these executables.
The <code>quarkus-micro-image:2.0</code> image is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>small (based on <code>ubi8-micro</code>)</p>
</li>
<li>
<p>designed for containers</p>
</li>
<li>
<p>contains the right set of dependencies (glibc, libstdc++, zlib)</p>
</li>
<li>
<p>support upx-compressed executables (more details on the <a href="upx">enabling compression documentation</a>)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-base-image"><a class="anchor" href="#using-the-base-image"></a>Using the base image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In your <code>Dockerfile</code>, just use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">FROM quay.io/quarkus/quarkus-micro-image:2.0
WORKDIR /work/
COPY target/*-runner /work/application
RUN chmod 775 /work
EXPOSE 8080
CMD ["./application", "-Dquarkus.http.host=0.0.0.0"]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extending-the-image"><a class="anchor" href="#extending-the-image"></a>Extending the image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Your application may have additional requirements.
For example, if you have an application that requires <code>libfreetype.so</code>, you need to copy the native libraries to the container.
In this case, you need to use a multi-stage <code>dockerfile</code> to copy the required libraries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile"># First stage - install the dependencies in an intermediate container
FROM registry.access.redhat.com/ubi8/ubi-minimal:8.6 as BUILD
RUN microdnf install freetype

# Second stage - copy the dependencies
FROM quay.io/quarkus/quarkus-micro-image:2.0
COPY --from=BUILD \
   /lib64/libfreetype.so.6 \
   /lib64/libbz2.so.1 \
   /lib64/libpng16.so.16 \
   /lib64/

WORKDIR /work/
COPY target/*-runner /work/application
RUN chmod 775 /work
EXPOSE 8080
CMD ["./application", "-Dquarkus.http.host=0.0.0.0"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to have access to the full AWT support, you need more than just <code>libfreetype.so</code>, but also the font and font configurations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile"># First stage - install the dependencies in an intermediate container
FROM registry.access.redhat.com/ubi8/ubi-minimal:8.6 as BUILD
RUN microdnf install freetype fontconfig

# Second stage - copy the dependencies
FROM quay.io/quarkus/quarkus-micro-image:2.0
COPY --from=BUILD \
   /lib64/libfreetype.so.6 \
   /lib64/libgcc_s.so.1 \
   /lib64/libbz2.so.1 \
   /lib64/libpng16.so.16 \
   /lib64/libm.so.6 \
   /lib64/libbz2.so.1 \
   /lib64/libexpat.so.1 \
   /lib64/libuuid.so.1 \
   /lib64/

COPY --from=BUILD \
   /usr/lib64/libfontconfig.so.1 \
   /usr/lib64/

COPY --from=BUILD \
    /usr/share/fonts /usr/share/fonts

COPY --from=BUILD \
    /usr/share/fontconfig /usr/share/fontconfig

COPY --from=BUILD \
    /usr/lib/fontconfig /usr/lib/fontconfig

COPY --from=BUILD \
     /etc/fonts /etc/fonts

WORKDIR /work/
COPY target/*-runner /work/application
RUN chmod 775 /work
EXPOSE 8080
CMD ["./application", "-Dquarkus.http.host=0.0.0.0"]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="alternative-using-ubi-minimal"><a class="anchor" href="#alternative-using-ubi-minimal"></a>Alternative - Using ubi-minimal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the micro image does not suit your requirements, you can use <a href="https://catalog.redhat.com/software/containers/ubi8/ubi-minimal/5c359a62bed8bd75a2c3fba8">ubi8/ubi-minimal</a>.
It&#8217;s a bigger image, but contains more utilities and is closer to a full Linux distribution.
Typically, it contains a package manager (<code>microdnf</code>), so you can install packages more easily.</p>
</div>
<div class="paragraph">
<p>To use this base image, use the following <code>Dockerfile</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">FROM registry.access.redhat.com/ubi8/ubi-minimal:8.6
WORKDIR /work/
RUN chown 1001 /work \
    &amp;&amp; chmod "g+rwX" /work \
    &amp;&amp; chown 1001:root /work
COPY --chown=1001:root target/*-runner /work/application

EXPOSE 8080
USER 1001

CMD ["./application", "-Dquarkus.http.host=0.0.0.0"]</code></pre>
</div>
</div>
</div>
</div>